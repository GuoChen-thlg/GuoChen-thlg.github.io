// build time:Sun Apr 11 2021 11:12:33 GMT+0800 (GMT+08:00)
void function(global,factory){if(typeof module==="object"&&typeof module.exports==="object"){module.exports=factory(global,true)}else if(typeof define==="function"&&define.amd){define(function(){return factory(global,true)})}else{factory(global)}}(typeof window!=="undefined"?window:this,function(window,noGlobalNS){"use strict";var document=window.document;var root=document.documentElement;var body=document.body;var VERSION="3.3.0";var ROUTINE=["initCond","renderElem","renderJiya","renderHanging","correctBiaodian","renderHWS","substCombLigaWithPUA"];var Han=function(context,condition){return new Han.fn.init(context,condition)};var init=function(){if(arguments[0]){this.context=arguments[0]}if(arguments[1]){this.condition=arguments[1]}return this};Han.version=VERSION;Han.fn=Han.prototype={version:VERSION,constructor:Han,context:body,condition:root,routine:ROUTINE,init:init,setRoutine:function(routine){if(Array.isArray(routine)){this.routine=routine}return this},render:function(routine){var it=this;var routine=Array.isArray(routine)?routine:this.routine;routine.forEach(function(method){if(typeof method==="string"&&typeof it[method]==="function"){it[method]()}else if(Array.isArray(method)&&typeof it[method[0]]==="function"){it[method.shift()].apply(it,method)}});return this}};Han.fn.init.prototype=Han.fn;Han.init=function(){return Han.init=Han().render()};var UNICODE={punct:{base:"[…,.;:!?‽_]",sing:"[‐-—…]",middle:"[\\/~\\-&‐-—_]",open:"['\"‘“\\(\\[¡¿⸘«‹‚“„]",close:"['\"”’\\)\\]»›‛”‟]",end:"['\"”’\\)\\]»›‛”‟‼‽⁇-⁉,.;:!?]"},biaodian:{base:"[︰．、，。：；？！ー]",liga:"[—…⋯]",middle:"[·＼／－゠＆・＿]",open:"[「『《〈（〔［｛【〖]",close:"[」』》〉）〕］｝】〗]",end:"[」』》〉）〕］｝】〗︰．、，。：；？！ー]"},hanzi:{base:"[一-鿿㐀-䶵㇀-㇣〇﨎﨏﨑﨓﨔﨟﨡﨣﨤﨧-﨩]|[�-�][�-�]",desc:"[⿰-⿺]",radical:"[⼀-⿕⺀-⻳]"},latin:{base:"[A-Za-z0-9À-ÿĀ-ſƀ-ɏⱠ-Ɀ꜠-ꟿḀ-ỿ]",combine:"[̀-́᷀-᷿]"},ellinika:{base:"[0-9Ͱ-Ͽἀ-῿]",combine:"[̀-᷀ͅ-᷿]"},kirillica:{base:"[0-9Ѐ-҂Ҋ-ӿԀ-ԯꙀ-ꙮ꙾-ꚗ]",combine:"[҃-҉ⷠ-ⷿ꙯-꙽ꚟ]"},kana:{base:"[アイウエオ-ヺあいうえお-ゔゟヿ]|�[�-�]",small:"[ぁぃぅぇぉァィゥェォっゃゅょゎゕゖッャュョヮヵヶㇰ-ㇿ]",combine:"[゙-゜]",half:"[ｦ-ﾟ]",mark:"[゠ゝゞ・-ヾ]"},eonmun:{base:"[가-힣]",letter:"[ᄀ-ᇿㅏ-ㅣㄱ-ㆎꥠ-ꥼힰ-ퟻ]",half:"[ﾡ-ￜ]"},zhuyin:{base:"[ㄅ-ㄭㆠ-ㆺ]",initial:"[ㄅ-ㄙㄪ-ㄬㆠ-ㆣ]",medial:"[ㄧ-ㄩ]","final":"[ㄚ-ㄩㄭㆤ-ㆳㆸ-ㆺ]",tone:"[˙ˊ˅ˇˋ˪˫]",checked:"[ㆴ-ㆷ][̍͘]?"}};var TYPESET=function(){var rWhite="[\\x20\\t\\r\\n\\f]";var rPtOpen=UNICODE.punct.open;var rPtClose=UNICODE.punct.close;var rPtEnd=UNICODE.punct.end;var rPtMid=UNICODE.punct.middle;var rPtSing=UNICODE.punct.sing;var rPt=rPtOpen+"|"+rPtEnd+"|"+rPtMid;var rBDOpen=UNICODE.biaodian.open;var rBDClose=UNICODE.biaodian.close;var rBDEnd=UNICODE.biaodian.end;var rBDMid=UNICODE.biaodian.middle;var rBDLiga=UNICODE.biaodian.liga+"{2}";var rBD=rBDOpen+"|"+rBDEnd+"|"+rBDMid;var rKana=UNICODE.kana.base+UNICODE.kana.combine+"?";var rKanaS=UNICODE.kana.small+UNICODE.kana.combine+"?";var rKanaH=UNICODE.kana.half;var rEon=UNICODE.eonmun.base+"|"+UNICODE.eonmun.letter;var rEonH=UNICODE.eonmun.half;var rHan=UNICODE.hanzi.base+"|"+UNICODE.hanzi.desc+"|"+UNICODE.hanzi.radical+"|"+rKana;var rCbn=UNICODE.ellinika.combine;var rLatn=UNICODE.latin.base+rCbn+"*";var rGk=UNICODE.ellinika.base+rCbn+"*";var rCyCbn=UNICODE.kirillica.combine;var rCy=UNICODE.kirillica.base+rCyCbn+"*";var rAlph=rLatn+"|"+rGk+"|"+rCy;var rApo="['’]";var rChar=rHan+"|(?:"+rAlph+"|"+rApo+")+";var rZyS=UNICODE.zhuyin.initial;var rZyJ=UNICODE.zhuyin.medial;var rZyY=UNICODE.zhuyin.final;var rZyD=UNICODE.zhuyin.tone+"|"+UNICODE.zhuyin.checked;return{"char":{punct:{all:new RegExp("("+rPt+")","g"),open:new RegExp("("+rPtOpen+")","g"),end:new RegExp("("+rPtEnd+")","g"),sing:new RegExp("("+rPtSing+")","g")},biaodian:{all:new RegExp("("+rBD+")","g"),open:new RegExp("("+rBDOpen+")","g"),close:new RegExp("("+rBDClose+")","g"),end:new RegExp("("+rBDEnd+")","g"),liga:new RegExp("("+rBDLiga+")","g")},hanzi:new RegExp("("+rHan+")","g"),latin:new RegExp("("+rLatn+")","ig"),ellinika:new RegExp("("+rGk+")","ig"),kirillica:new RegExp("("+rCy+")","ig"),kana:new RegExp("("+rKana+"|"+rKanaS+"|"+rKanaH+")","g"),eonmun:new RegExp("("+rEon+"|"+rEonH+")","g")},group:{biaodian:[new RegExp("(("+rBD+"){2,})","g"),new RegExp("("+rBDLiga+rBDOpen+")","g")],punct:null,hanzi:new RegExp("("+rHan+")+","g"),western:new RegExp("("+rLatn+"|"+rGk+"|"+rCy+"|"+rPt+")+","ig"),kana:new RegExp("("+rKana+"|"+rKanaS+"|"+rKanaH+")+","g"),eonmun:new RegExp("("+rEon+"|"+rEonH+"|"+rPt+")+","g")},jinze:{hanging:new RegExp(rWhite+"*([、，。．])(?!"+rBDEnd+")","ig"),touwei:new RegExp("("+rBDOpen+"+)("+rChar+")("+rBDEnd+"+)","ig"),tou:new RegExp("("+rBDOpen+"+)("+rChar+")","ig"),wei:new RegExp("("+rChar+")("+rBDEnd+"+)","ig"),middle:new RegExp("("+rChar+")("+rBDMid+")("+rChar+")","ig")},zhuyin:{form:new RegExp("^˙?("+rZyS+")?("+rZyJ+")?("+rZyY+")?("+rZyD+")?$"),diao:new RegExp("("+rZyD+")","g")},hws:{base:[new RegExp("("+rHan+")("+rAlph+"|"+rPtOpen+")","ig"),new RegExp("("+rAlph+"|"+rPtEnd+")("+rHan+")","ig")],strict:[new RegExp("("+rHan+")"+rWhite+"?("+rAlph+"|"+rPtOpen+")","ig"),new RegExp("("+rAlph+"|"+rPtEnd+")"+rWhite+"?("+rHan+")","ig")]},"display-as":{"ja-font-for-hant":["查 査","啟 啓","鄉 鄕","值 値","污 汚"],"comb-liga-pua":[["a[̍͘]","󰁡"],["e[̍͘]","󰁥"],["i[̍͘]","󰁩"],["o[̍͘]","󰁯"],["u[̍͘]","󰁵"],["ㆴ[̍͘]","󳆴"],["ㆵ[̍͘]","󳆵"],["ㆶ[̍͘]","󳆶"],["ㆷ[̍͘]","󳆷"]],"comb-liga-vowel":[["a[̍͘]","󰁡"],["e[̍͘]","󰁥"],["i[̍͘]","󰁩"],["o[̍͘]","󰁯"],["u[̍͘]","󰁵"]],"comb-liga-zhuyin":[["ㆴ[̍͘]","󳆴"],["ㆵ[̍͘]","󳆵"],["ㆶ[̍͘]","󳆶"],["ㆷ[̍͘]","󳆷"]]},"inaccurate-char":[["[•‧]","·"],["⋯⋯","……"],["──","——"],["‵","‘"],["′","’"],["‶","“"],["″","”"]]}}();Han.UNICODE=UNICODE;Han.TYPESET=TYPESET;Han.UNICODE.cjk=Han.UNICODE.hanzi;Han.UNICODE.greek=Han.UNICODE.ellinika;Han.UNICODE.cyrillic=Han.UNICODE.kirillica;Han.UNICODE.hangul=Han.UNICODE.eonmun;Han.UNICODE.zhuyin.ruyun=Han.UNICODE.zhuyin.checked;Han.TYPESET.char.cjk=Han.TYPESET.char.hanzi;Han.TYPESET.char.greek=Han.TYPESET.char.ellinika;Han.TYPESET.char.cyrillic=Han.TYPESET.char.kirillica;Han.TYPESET.char.hangul=Han.TYPESET.char.eonmun;Han.TYPESET.group.hangul=Han.TYPESET.group.eonmun;Han.TYPESET.group.cjk=Han.TYPESET.group.hanzi;var $={id:function(selector,$context){return($context||document).getElementById(selector)},tag:function(selector,$context){return this.makeArray(($context||document).getElementsByTagName(selector))},qs:function(selector,$context){return($context||document).querySelector(selector)},qsa:function(selector,$context){return this.makeArray(($context||document).querySelectorAll(selector))},parent:function($node,selector){return selector?function(){if(typeof $.matches!=="function")return;while(!$.matches($node,selector)){if(!$node||$node===document.documentElement){$node=undefined;break}$node=$node.parentNode}return $node}():$node?$node.parentNode:undefined},create:function(name,clazz){var $elmt="!"===name?document.createDocumentFragment():""===name?document.createTextNode(clazz||""):document.createElement(name);try{if(clazz){$elmt.className=clazz}}catch(e){}return $elmt},clone:function($node,deep){return $node.cloneNode(typeof deep==="boolean"?deep:true)},remove:function($node){return $node.parentNode.removeChild($node)},setAttr:function(target,attr){if(typeof attr!=="object")return;var len=attr.length;if(typeof attr[0]==="object"&&"name"in attr[0]){for(var i=0;i<len;i++){if(attr[i].value!==undefined){target.setAttribute(attr[i].name,attr[i].value)}}}else{for(var name in attr){if(attr.hasOwnProperty(name)&&attr[name]!==undefined){target.setAttribute(name,attr[name])}}}return target},isElmt:function($node){return $node&&$node.nodeType===Node.ELEMENT_NODE},isIgnorable:function($node){if(!$node)return false;return $node.nodeName==="WBR"||$node.nodeType===Node.COMMENT_NODE},makeArray:function(object){return Array.prototype.slice.call(object)},extend:function(target,object){if((typeof target==="object"||typeof target==="function")&&typeof object==="object"){for(var name in object){if(object.hasOwnProperty(name)){target[name]=object[name]}}}return target}};var Fibre=function(Finder){"use strict";var VERSION="0.2.1";var NON_INLINE_PROSE=Finder.NON_INLINE_PROSE;var AVOID_NON_PROSE=Finder.PRESETS.prose.filterElements;var global=window||{};var document=global.document||undefined;function matches(node,selector,bypassNodeType39){var Efn=Element.prototype;var matches=Efn.matches||Efn.mozMatchesSelector||Efn.msMatchesSelector||Efn.webkitMatchesSelector;if(node instanceof Element){return matches.call(node,selector)}else if(bypassNodeType39){if(/^[39]$/.test(node.nodeType))return true}return false}if(typeof document==="undefined")throw new Error("Fibre requires a DOM-supported environment.");var Fibre=function(context,preset){return new Fibre.fn.init(context,preset)};Fibre.version=VERSION;Fibre.matches=matches;Fibre.fn=Fibre.prototype={constructor:Fibre,version:VERSION,finder:[],context:undefined,portionMode:"retain",selector:{},preset:"prose",init:function(context,noPreset){if(!!noPreset)this.preset=null;this.selector={context:null,filter:[],avoid:[],boundary:[]};if(!context){throw new Error("A context is required for Fibre to initialise.")}else if(context instanceof Node){if(context instanceof Document)this.context=context.body||context;else this.context=context}else if(typeof context==="string"){this.context=document.querySelector(context);this.selector.context=context}return this},filterFn:function(node){var filter=this.selector.filter.join(", ")||"*";var avoid=this.selector.avoid.join(", ")||null;var result=matches(node,filter,true)&&!matches(node,avoid);return this.preset==="prose"?AVOID_NON_PROSE(node)&&result:result},boundaryFn:function(node){var boundary=this.selector.boundary.join(", ")||null;var result=matches(node,boundary);return this.preset==="prose"?NON_INLINE_PROSE(node)||result:result},filter:function(selector){if(typeof selector==="string"){this.selector.filter.push(selector)}return this},endFilter:function(all){if(all){this.selector.filter=[]}else{this.selector.filter.pop()}return this},avoid:function(selector){if(typeof selector==="string"){this.selector.avoid.push(selector)}return this},endAvoid:function(all){if(all){this.selector.avoid=[]}else{this.selector.avoid.pop()}return this},addBoundary:function(selector){if(typeof selector==="string"){this.selector.boundary.push(selector)}return this},removeBoundary:function(){this.selector.boundary=[];return this},setMode:function(portionMode){this.portionMode=portionMode==="first"?"first":"retain";return this},replace:function(regexp,newSubStr){var it=this;it.finder.push(Finder(it.context,{find:regexp,replace:newSubStr,filterElements:function(currentNode){return it.filterFn(currentNode)},forceContext:function(currentNode){return it.boundaryFn(currentNode)},portionMode:it.portionMode}));return it},wrap:function(regexp,strElemName){var it=this;it.finder.push(Finder(it.context,{find:regexp,wrap:strElemName,filterElements:function(currentNode){return it.filterFn(currentNode)},forceContext:function(currentNode){return it.boundaryFn(currentNode)},portionMode:it.portionMode}));return it},revert:function(level){var max=this.finder.length;var level=Number(level)||(level===0?Number(0):level==="all"?max:1);if(typeof max==="undefined"||max===0)return this;else if(level>max)level=max;for(var i=level;i>0;i--){this.finder.pop().revert()}return this}};Fibre.fn.filterOut=Fibre.fn.avoid;Fibre.fn.init.prototype=Fibre.fn;return Fibre}(function(){var PORTION_MODE_RETAIN="retain";var PORTION_MODE_FIRST="first";var doc=document;var toString={}.toString;var hasOwn={}.hasOwnProperty;function isArray(a){return toString.call(a)=="[object Array]"}function escapeRegExp(s){return String(s).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function exposed(){return deprecated.apply(null,arguments)||findAndReplaceDOMText.apply(null,arguments)}function deprecated(regex,node,replacement,captureGroup,elFilter){if(node&&!node.nodeType&&arguments.length<=2){return false}var isReplacementFunction=typeof replacement=="function";if(isReplacementFunction){replacement=function(original){return function(portion,match){return original(portion.text,match.startIndex)}}(replacement)}var instance=findAndReplaceDOMText(node,{find:regex,wrap:isReplacementFunction?null:replacement,replace:isReplacementFunction?replacement:"$"+(captureGroup||"&"),prepMatch:function(m,mi){if(!m[0])throw"findAndReplaceDOMText cannot handle zero-length matches";if(captureGroup>0){var cg=m[captureGroup];m.index+=m[0].indexOf(cg);m[0]=cg}m.endIndex=m.index+m[0].length;m.startIndex=m.index;m.index=mi;return m},filterElements:elFilter});exposed.revert=function(){return instance.revert()};return true}function findAndReplaceDOMText(node,options){return new Finder(node,options)}exposed.NON_PROSE_ELEMENTS={br:1,hr:1,script:1,style:1,img:1,video:1,audio:1,canvas:1,svg:1,map:1,object:1,input:1,textarea:1,select:1,option:1,optgroup:1,button:1};exposed.NON_CONTIGUOUS_PROSE_ELEMENTS={address:1,article:1,aside:1,blockquote:1,dd:1,div:1,dl:1,fieldset:1,figcaption:1,figure:1,footer:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,header:1,hgroup:1,hr:1,main:1,nav:1,noscript:1,ol:1,output:1,p:1,pre:1,section:1,ul:1,br:1,li:1,summary:1,dt:1,details:1,rp:1,rt:1,rtc:1,script:1,style:1,img:1,video:1,audio:1,canvas:1,svg:1,map:1,object:1,input:1,textarea:1,select:1,option:1,optgroup:1,button:1,table:1,tbody:1,thead:1,th:1,tr:1,td:1,caption:1,col:1,tfoot:1,colgroup:1};exposed.NON_INLINE_PROSE=function(el){return hasOwn.call(exposed.NON_CONTIGUOUS_PROSE_ELEMENTS,el.nodeName.toLowerCase())};exposed.PRESETS={prose:{forceContext:exposed.NON_INLINE_PROSE,filterElements:function(el){return!hasOwn.call(exposed.NON_PROSE_ELEMENTS,el.nodeName.toLowerCase())}}};exposed.Finder=Finder;function Finder(node,options){var preset=options.preset&&exposed.PRESETS[options.preset];options.portionMode=options.portionMode||PORTION_MODE_RETAIN;if(preset){for(var i in preset){if(hasOwn.call(preset,i)&&!hasOwn.call(options,i)){options[i]=preset[i]}}}this.node=node;this.options=options;this.prepMatch=options.prepMatch||this.prepMatch;this.reverts=[];this.matches=this.search();if(this.matches.length){this.processMatches()}}Finder.prototype={search:function(){var match;var matchIndex=0;var offset=0;var regex=this.options.find;var textAggregation=this.getAggregateText();var matches=[];var self=this;regex=typeof regex==="string"?RegExp(escapeRegExp(regex),"g"):regex;matchAggregation(textAggregation);function matchAggregation(textAggregation){for(var i=0,l=textAggregation.length;i<l;++i){var text=textAggregation[i];if(typeof text!=="string"){matchAggregation(text);continue}if(regex.global){while(match=regex.exec(text)){matches.push(self.prepMatch(match,matchIndex++,offset))}}else{if(match=text.match(regex)){matches.push(self.prepMatch(match,0,offset))}}offset+=text.length}}return matches},prepMatch:function(match,matchIndex,characterOffset){if(!match[0]){throw new Error("findAndReplaceDOMText cannot handle zero-length matches")}match.endIndex=characterOffset+match.index+match[0].length;match.startIndex=characterOffset+match.index;match.index=matchIndex;return match},getAggregateText:function(){var elementFilter=this.options.filterElements;var forceContext=this.options.forceContext;return getText(this.node);function getText(node,txt){if(node.nodeType===3){return[node.data]}if(elementFilter&&!elementFilter(node)){return[]}var txt=[""];var i=0;if(node=node.firstChild)do{if(node.nodeType===3){txt[i]+=node.data;continue}var innerText=getText(node);if(forceContext&&node.nodeType===1&&(forceContext===true||forceContext(node))){txt[++i]=innerText;txt[++i]=""}else{if(typeof innerText[0]==="string"){txt[i]+=innerText.shift()}if(innerText.length){txt[++i]=innerText;txt[++i]=""}}}while(node=node.nextSibling);return txt}},processMatches:function(){var matches=this.matches;var node=this.node;var elementFilter=this.options.filterElements;var startPortion,endPortion,innerPortions=[],curNode=node,match=matches.shift(),atIndex=0,matchIndex=0,portionIndex=0,doAvoidNode,nodeStack=[node];out:while(true){if(curNode.nodeType===3){if(!endPortion&&curNode.length+atIndex>=match.endIndex){endPortion={node:curNode,index:portionIndex++,text:curNode.data.substring(match.startIndex-atIndex,match.endIndex-atIndex),indexInMatch:atIndex-match.startIndex,indexInNode:match.startIndex-atIndex,endIndexInNode:match.endIndex-atIndex,isEnd:true}}else if(startPortion){innerPortions.push({node:curNode,index:portionIndex++,text:curNode.data,indexInMatch:atIndex-match.startIndex,indexInNode:0})}if(!startPortion&&curNode.length+atIndex>match.startIndex){startPortion={node:curNode,index:portionIndex++,indexInMatch:0,indexInNode:match.startIndex-atIndex,endIndexInNode:match.endIndex-atIndex,text:curNode.data.substring(match.startIndex-atIndex,match.endIndex-atIndex)}}atIndex+=curNode.data.length}doAvoidNode=curNode.nodeType===1&&elementFilter&&!elementFilter(curNode);if(startPortion&&endPortion){curNode=this.replaceMatch(match,startPortion,innerPortions,endPortion);atIndex-=endPortion.node.data.length-endPortion.endIndexInNode;startPortion=null;endPortion=null;innerPortions=[];match=matches.shift();portionIndex=0;matchIndex++;if(!match){break}}else if(!doAvoidNode&&(curNode.firstChild||curNode.nextSibling)){if(curNode.firstChild){nodeStack.push(curNode);curNode=curNode.firstChild}else{curNode=curNode.nextSibling}continue}while(true){if(curNode.nextSibling){curNode=curNode.nextSibling;break}curNode=nodeStack.pop();if(curNode===node){break out}}}},revert:function(){for(var l=this.reverts.length;l--;){this.reverts[l]()}this.reverts=[]},prepareReplacementString:function(string,portion,match,matchIndex){var portionMode=this.options.portionMode;if(portionMode===PORTION_MODE_FIRST&&portion.indexInMatch>0){return""}string=string.replace(/\$(\d+|&|`|')/g,function($0,t){var replacement;switch(t){case"&":replacement=match[0];break;case"`":replacement=match.input.substring(0,match.startIndex);break;case"'":replacement=match.input.substring(match.endIndex);break;default:replacement=match[+t]}return replacement});if(portionMode===PORTION_MODE_FIRST){return string}if(portion.isEnd){return string.substring(portion.indexInMatch)}return string.substring(portion.indexInMatch,portion.indexInMatch+portion.text.length)},getPortionReplacementNode:function(portion,match,matchIndex){var replacement=this.options.replace||"$&";var wrapper=this.options.wrap;if(wrapper&&wrapper.nodeType){var clone=doc.createElement("div");clone.innerHTML=wrapper.outerHTML||(new XMLSerializer).serializeToString(wrapper);wrapper=clone.firstChild}if(typeof replacement=="function"){replacement=replacement(portion,match,matchIndex);if(replacement&&replacement.nodeType){return replacement}return doc.createTextNode(String(replacement))}var el=typeof wrapper=="string"?doc.createElement(wrapper):wrapper;replacement=doc.createTextNode(this.prepareReplacementString(replacement,portion,match,matchIndex));if(!replacement.data){return replacement}if(!el){return replacement}el.appendChild(replacement);return el},replaceMatch:function(match,startPortion,innerPortions,endPortion){var matchStartNode=startPortion.node;var matchEndNode=endPortion.node;var preceedingTextNode;var followingTextNode;if(matchStartNode===matchEndNode){var node=matchStartNode;if(startPortion.indexInNode>0){preceedingTextNode=doc.createTextNode(node.data.substring(0,startPortion.indexInNode));node.parentNode.insertBefore(preceedingTextNode,node)}var newNode=this.getPortionReplacementNode(endPortion,match);node.parentNode.insertBefore(newNode,node);if(endPortion.endIndexInNode<node.length){followingTextNode=doc.createTextNode(node.data.substring(endPortion.endIndexInNode));node.parentNode.insertBefore(followingTextNode,node)}node.parentNode.removeChild(node);this.reverts.push(function(){if(preceedingTextNode===newNode.previousSibling){preceedingTextNode.parentNode.removeChild(preceedingTextNode)}if(followingTextNode===newNode.nextSibling){followingTextNode.parentNode.removeChild(followingTextNode)}newNode.parentNode.replaceChild(node,newNode)});return newNode}else{preceedingTextNode=doc.createTextNode(matchStartNode.data.substring(0,startPortion.indexInNode));followingTextNode=doc.createTextNode(matchEndNode.data.substring(endPortion.endIndexInNode));var firstNode=this.getPortionReplacementNode(startPortion,match);var innerNodes=[];for(var i=0,l=innerPortions.length;i<l;++i){var portion=innerPortions[i];var innerNode=this.getPortionReplacementNode(portion,match);portion.node.parentNode.replaceChild(innerNode,portion.node);this.reverts.push(function(portion,innerNode){return function(){innerNode.parentNode.replaceChild(portion.node,innerNode)}}(portion,innerNode));innerNodes.push(innerNode)}var lastNode=this.getPortionReplacementNode(endPortion,match);matchStartNode.parentNode.insertBefore(preceedingTextNode,matchStartNode);matchStartNode.parentNode.insertBefore(firstNode,matchStartNode);matchStartNode.parentNode.removeChild(matchStartNode);matchEndNode.parentNode.insertBefore(lastNode,matchEndNode);matchEndNode.parentNode.insertBefore(followingTextNode,matchEndNode);matchEndNode.parentNode.removeChild(matchEndNode);this.reverts.push(function(){preceedingTextNode.parentNode.removeChild(preceedingTextNode);firstNode.parentNode.replaceChild(matchStartNode,firstNode);followingTextNode.parentNode.removeChild(followingTextNode);lastNode.parentNode.replaceChild(matchEndNode,lastNode)});return lastNode}}};return exposed}());var isNodeNormalizeNormal=function(){var div=$.create("div");div.appendChild($.create("","0-"));div.appendChild($.create("","2"));div.normalize();return div.firstChild.length!==2}();function getFuncOrElmt(obj){return typeof obj==="function"||obj instanceof Element?obj:undefined}function createBDGroup(portion){var clazz=portion.index===0&&portion.isEnd?"biaodian cjk":"biaodian cjk portion "+(portion.index===0?"is-first":portion.isEnd?"is-end":"is-inner");var $elmt=$.create("h-char-group",clazz);$elmt.innerHTML=portion.text;return $elmt}function createBDChar(char){var div=$.create("div");var unicode=char.charCodeAt(0).toString(16);div.innerHTML='<h-char unicode="'+unicode+'" class="biaodian cjk '+getBDType(char)+'">'+char+"</h-char>";return div.firstChild}function getBDType(char){return char.match(TYPESET.char.biaodian.open)?"bd-open":char.match(TYPESET.char.biaodian.close)?"bd-close bd-end":char.match(TYPESET.char.biaodian.end)?/(?:\u3001|\u3002|\uff0c)/i.test(char)?"bd-end bd-cop":"bd-end":char.match(new RegExp(UNICODE.biaodian.liga))?"bd-liga":char.match(new RegExp(UNICODE.biaodian.middle))?"bd-middle":""}$.extend(Fibre.fn,{normalize:function(){if(isNodeNormalizeNormal){this.context.normalize()}return this},jinzify:function(selector){return this.filter(selector||null).avoid("h-jinze").replace(TYPESET.jinze.touwei,function(portion,match){var elem=$.create("h-jinze","touwei");elem.innerHTML=match[0];return portion.index===0&&portion.isEnd||portion.index===1?elem:""}).replace(TYPESET.jinze.wei,function(portion,match){var elem=$.create("h-jinze","wei");elem.innerHTML=match[0];return portion.index===0?elem:""}).replace(TYPESET.jinze.tou,function(portion,match){var elem=$.create("h-jinze","tou");elem.innerHTML=match[0];return portion.index===0&&portion.isEnd||portion.index===1?elem:""}).replace(TYPESET.jinze.middle,function(portion,match){var elem=$.create("h-jinze","middle");elem.innerHTML=match[0];return portion.index===0&&portion.isEnd||portion.index===1?elem:""}).endAvoid().endFilter()},groupify:function(option){var option=$.extend({biaodian:false,hanzi:false,kana:false,eonmun:false,western:false},option||{});this.avoid("h-word, h-char-group");if(option.biaodian){this.replace(TYPESET.group.biaodian[0],createBDGroup).replace(TYPESET.group.biaodian[1],createBDGroup)}if(option.hanzi||option.cjk){this.wrap(TYPESET.group.hanzi,$.clone($.create("h-char-group","hanzi cjk")))}if(option.western){this.wrap(TYPESET.group.western,$.clone($.create("h-word","western")))}if(option.kana){this.wrap(TYPESET.group.kana,$.clone($.create("h-char-group","kana")))}if(option.eonmun||option.hangul){this.wrap(TYPESET.group.eonmun,$.clone($.create("h-word","eonmun hangul")))}this.endAvoid();return this},charify:function(option){var option=$.extend({avoid:true,biaodian:false,punct:false,hanzi:false,latin:false,ellinika:false,kirillica:false,kana:false,eonmun:false},option||{});if(option.avoid){this.avoid("h-char")}if(option.biaodian){this.replace(TYPESET.char.biaodian.all,getFuncOrElmt(option.biaodian)||function(portion){return createBDChar(portion.text)}).replace(TYPESET.char.biaodian.liga,getFuncOrElmt(option.biaodian)||function(portion){return createBDChar(portion.text)})}if(option.hanzi||option.cjk){this.wrap(TYPESET.char.hanzi,getFuncOrElmt(option.hanzi||option.cjk)||$.clone($.create("h-char","hanzi cjk")))}if(option.punct){this.wrap(TYPESET.char.punct.all,getFuncOrElmt(option.punct)||$.clone($.create("h-char","punct")))}if(option.latin){this.wrap(TYPESET.char.latin,getFuncOrElmt(option.latin)||$.clone($.create("h-char","alphabet latin")))}if(option.ellinika||option.greek){this.wrap(TYPESET.char.ellinika,getFuncOrElmt(option.ellinika||option.greek)||$.clone($.create("h-char","alphabet ellinika greek")))}if(option.kirillica||option.cyrillic){this.wrap(TYPESET.char.kirillica,getFuncOrElmt(option.kirillica||option.cyrillic)||$.clone($.create("h-char","alphabet kirillica cyrillic")))}if(option.kana){this.wrap(TYPESET.char.kana,getFuncOrElmt(option.kana)||$.clone($.create("h-char","kana")))}if(option.eonmun||option.hangul){this.wrap(TYPESET.char.eonmun,getFuncOrElmt(option.eonmun||option.hangul)||$.clone($.create("h-char","eonmun hangul")))}this.endAvoid();return this}});$.extend(Han,{isNodeNormalizeNormal:isNodeNormalizeNormal,find:Fibre,createBDGroup:createBDGroup,createBDChar:createBDChar});$.matches=Han.find.matches;void["setMode","wrap","replace","revert","addBoundary","removeBoundary","avoid","endAvoid","filter","endFilter","jinzify","groupify","charify"].forEach(function(method){Han.fn[method]=function(){if(!this.finder){this.finder=Han.find(this.context)}this.finder[method](arguments[0],arguments[1]);return this}});var Locale={};function writeOnCanvas(text,font){var canvas=$.create("canvas");var context;canvas.width="50";canvas.height="20";canvas.style.display="none";body.appendChild(canvas);context=canvas.getContext("2d");context.textBaseline="top";context.font="15px "+font+", sans-serif";context.fillStyle="black";context.strokeStyle="black";context.fillText(text,0,0);return{node:canvas,context:context,remove:function(){$.remove(canvas,body)}}}function compareCanvases(treat,control){var ret;var a=treat.context;var b=control.context;try{for(var j=1;j<=20;j++){for(var i=1;i<=50;i++){if(typeof ret==="undefined"&&a.getImageData(i,j,1,1).data[3]!==b.getImageData(i,j,1,1).data[3]){ret=false;break}else if(typeof ret==="boolean"){break}if(i===50&&j===20&&typeof ret==="undefined"){ret=true}}}treat.remove();control.remove();treat=null;control=null;return ret}catch(e){}return false}function detectFont(treat,control,text){var treat=treat;var control=control||"sans-serif";var text=text||"辭Q";var ret;control=writeOnCanvas(text,control);treat=writeOnCanvas(text,treat);return!compareCanvases(treat,control)}Locale.writeOnCanvas=writeOnCanvas;Locale.compareCanvases=compareCanvases;Locale.detectFont=detectFont;Locale.support=function(){var PREFIX="Webkit Moz ms".split(" ");var elem=$.create("h-test");function testCSSProp(prop){var ucProp=prop.charAt(0).toUpperCase()+prop.slice(1);var allProp=(prop+" "+PREFIX.join(ucProp+" ")+ucProp).split(" ");var ret;allProp.forEach(function(prop){if(typeof elem.style[prop]==="string"){ret=true}});return ret||false}function injectElementWithStyle(rule,callback){var fakeBody=body||$.create("body");var div=$.create("div");var container=body?div:fakeBody;var callback=typeof callback==="function"?callback:function(){};var style,ret,docOverflow;style=["<style>",rule,"</style>"].join("");container.innerHTML+=style;fakeBody.appendChild(div);if(!body){fakeBody.style.background="";fakeBody.style.overflow="hidden";docOverflow=root.style.overflow;root.style.overflow="hidden";root.appendChild(fakeBody)}ret=callback(container,rule);$.remove(container);if(!body){root.style.overflow=docOverflow}return!!ret}function getStyle(elem,prop){var ret;if(window.getComputedStyle){ret=document.defaultView.getComputedStyle(elem,null).getPropertyValue(prop)}else if(elem.currentStyle){ret=elem.currentStyle[prop]}return ret}return{columnwidth:testCSSProp("columnWidth"),fontface:function(){var ret;injectElementWithStyle('@font-face { font-family: font; src: url("//"); }',function(node,rule){var style=$.qsa("style",node)[0];var sheet=style.sheet||style.styleSheet;var cssText=sheet?sheet.cssRules&&sheet.cssRules[0]?sheet.cssRules[0].cssText:sheet.cssText||"":"";ret=/src/i.test(cssText)&&cssText.indexOf(rule.split(" ")[0])===0});return ret}(),ruby:function(){var ruby=$.create("ruby");var rt=$.create("rt");var rp=$.create("rp");var ret;ruby.appendChild(rp);ruby.appendChild(rt);root.appendChild(ruby);ret=getStyle(rp,"display")==="none"||getStyle(ruby,"display")==="ruby"&&getStyle(rt,"display")==="ruby-text"?true:false;root.removeChild(ruby);ruby=null;rt=null;rp=null;return ret}(),"ruby-display":function(){var div=$.create("div");div.innerHTML='<h-test-a style="display: ruby;"></h-test-a><h-test-b style="display: ruby-text-container;"></h-test-b>';return div.querySelector("h-test-a").style.display==="ruby"&&div.querySelector("h-test-b").style.display==="ruby-text-container"}(),"ruby-interchar":function(){var IC="inter-character";var div=$.create("div");var css;div.innerHTML='<h-test style="-moz-ruby-position:'+IC+";-ms-ruby-position:"+IC+";-webkit-ruby-position:"+IC+";ruby-position:"+IC+';"></h-test>';css=div.querySelector("h-test").style;return css.rubyPosition===IC||css.WebkitRubyPosition===IC||css.MozRubyPosition===IC||css.msRubyPosition===IC}(),textemphasis:testCSSProp("textEmphasis"),unicoderange:function(){var ret;injectElementWithStyle('@font-face{font-family:test-for-unicode-range;src:local(Arial),local("Droid Sans")}@font-face{font-family:test-for-unicode-range;src:local("Times New Roman"),local(Times),local("Droid Serif");unicode-range:U+270C}',function(){ret=!Locale.detectFont("test-for-unicode-range",'Arial, "Droid Sans"',"Q")});return ret}(),writingmode:testCSSProp("writingMode")}}();Locale.initCond=function(target){var target=target||root;var ret="";var clazz;for(var feature in Locale.support){clazz=(Locale.support[feature]?"":"no-")+feature;target.classList.add(clazz);ret+=clazz+" "}return ret};var SUPPORT_IC=Locale.support["ruby-interchar"];function renderSimpleRuby($ruby){var frag=$.create("!");var clazz=$ruby.classList;var $rb,$ru;frag.appendChild($.clone($ruby));$.tag("rt",frag.firstChild).forEach(function($rt){var $rb=$.create("!");var airb=[];var irb;do{irb=(irb||$rt).previousSibling;if(!irb||irb.nodeName.match(/((?:h\-)?r[ubt])/i))break;$rb.insertBefore($.clone(irb),$rb.firstChild);airb.push(irb)}while(!irb.nodeName.match(/((?:h\-)?r[ubt])/i));$ru=clazz.contains("zhuyin")?createZhuyinRu($rb,$rt):createNormalRu($rb,$rt);try{$rt.parentNode.replaceChild($ru,$rt);airb.map($.remove)}catch(e){}});return createCustomRuby(frag)}function renderInterCharRuby($ruby){var frag=$.create("!");frag.appendChild($.clone($ruby));$.tag("rt",frag.firstChild).forEach(function($rt){var $rb=$.create("!");var airb=[];var irb,$zhuyin;do{irb=(irb||$rt).previousSibling;if(!irb||irb.nodeName.match(/((?:h\-)?r[ubt])/i))break;$rb.insertBefore($.clone(irb),$rb.firstChild);airb.push(irb)}while(!irb.nodeName.match(/((?:h\-)?r[ubt])/i));$zhuyin=$.create("rt");$zhuyin.innerHTML=getZhuyinHTML($rt);$rt.parentNode.replaceChild($zhuyin,$rt)});return frag.firstChild}function renderComplexRuby($ruby){var frag=$.create("!");var clazz=$ruby.classList;var $cloned,$rb,$ru,maxspan;frag.appendChild($.clone($ruby));$cloned=frag.firstChild;$rb=$ru=$.tag("rb",$cloned);maxspan=$rb.length;void function($rtc){if(!$rtc)return;$ru=$.tag("rt",$rtc).map(function($rt,i){if(!$rb[i])return;var ret=createZhuyinRu($rb[i],$rt);try{$rb[i].parentNode.replaceChild(ret,$rb[i]);
}catch(e){}return ret});$.remove($rtc);$cloned.setAttribute("rightangle","true")}($cloned.querySelector("rtc.zhuyin"));$.qsa("rtc:not(.zhuyin)",$cloned).forEach(function($rtc,order){var ret;ret=$.tag("rt",$rtc).map(function($rt,i){var rbspan=Number($rt.getAttribute("rbspan")||1);var span=0;var aRb=[];var $rb,ret;if(rbspan>maxspan)rbspan=maxspan;do{try{$rb=$ru.shift();aRb.push($rb)}catch(e){}if(typeof $rb==="undefined")break;span+=Number($rb.getAttribute("span")||1)}while(rbspan>span);if(rbspan<span){if(aRb.length>1){console.error("An impossible `rbspan` value detected.",ruby);return}aRb=$.tag("rb",aRb[0]);$ru=aRb.slice(rbspan).concat($ru);aRb=aRb.slice(0,rbspan);span=rbspan}ret=createNormalRu(aRb,$rt,{"class":clazz,span:span,order:order});try{aRb[0].parentNode.replaceChild(ret,aRb.shift());aRb.map($.remove)}catch(e){}return ret});$ru=ret;if(order===1)$cloned.setAttribute("doubleline","true");$.remove($rtc)});return createCustomRuby(frag)}function createCustomRuby(frag){var $ruby=frag.firstChild;var hruby=$.create("h-ruby");hruby.innerHTML=$ruby.innerHTML;$.setAttr(hruby,$ruby.attributes);hruby.normalize();return hruby}function simplifyRubyClass(elem){if(!elem instanceof Element)return elem;var clazz=elem.classList;if(clazz.contains("pinyin"))clazz.add("romanization");else if(clazz.contains("romanization"))clazz.add("annotation");else if(clazz.contains("mps"))clazz.add("zhuyin");else if(clazz.contains("rightangle"))clazz.add("complex");return elem}function createNormalRu($rb,$rt,attr){var $ru=$.create("h-ru");var $rt=$.clone($rt);var attr=attr||{};attr.annotation="true";if(Array.isArray($rb)){$ru.innerHTML=$rb.map(function(rb){if(typeof rb==="undefined")return"";return rb.outerHTML}).join("")+$rt.outerHTML}else{$ru.appendChild($.clone($rb));$ru.appendChild($rt)}$.setAttr($ru,attr);return $ru}function createZhuyinRu($rb,$rt){var $rb=$.clone($rb);var $ru=$.create("h-ru");$ru.setAttribute("zhuyin",true);$ru.appendChild($rb);$ru.innerHTML+=getZhuyinHTML($rt);return $ru}function getZhuyinHTML(rt){var zhuyin=typeof rt==="string"?rt:rt.textContent;var yin,diao,len;yin=zhuyin.replace(TYPESET.zhuyin.diao,"");len=yin?yin.length:0;diao=zhuyin.replace(yin,"").replace(/[\u02C5]/g,"ˇ").replace(/[\u030D]/g,"͘");return len===0?"":'<h-zhuyin length="'+len+'" diao="'+diao+'"><h-yin>'+yin+"</h-yin><h-diao>"+diao+"</h-diao></h-zhuyin>"}$.extend(Locale,{renderRuby:function(context,target){var target=target||"ruby";var $target=$.qsa(target,context);$.qsa("rtc",context).concat($target).map(simplifyRubyClass);$target.forEach(function($ruby){var clazz=$ruby.classList;var $new;if(clazz.contains("complex"))$new=renderComplexRuby($ruby);else if(clazz.contains("zhuyin"))$new=SUPPORT_IC?renderInterCharRuby($ruby):renderSimpleRuby($ruby);if($new)$ruby.parentNode.replaceChild($new,$ruby)})},simplifyRubyClass:simplifyRubyClass,getZhuyinHTML:getZhuyinHTML,renderComplexRuby:renderComplexRuby,renderSimpleRuby:renderSimpleRuby,renderInterCharRuby:renderInterCharRuby});$.extend(Locale,{renderElem:function(context){this.renderRuby(context);this.renderDecoLine(context);this.renderDecoLine(context,"s, del");this.renderEm(context)},renderDecoLine:function(context,target){var $$target=$.qsa(target||"u, ins",context);var i=$$target.length;traverse:while(i--){var $this=$$target[i];var $prev=null;ignore:do{$prev=($prev||$this).previousSibling;if(!$prev){continue traverse}else if($$target[i-1]===$prev){$this.classList.add("adjacent")}}while($.isIgnorable($prev))}},renderEm:function(context,target){var method=target?"qsa":"tag";var target=target||"em";var $target=$[method](target,context);$target.forEach(function(elem){var $elem=Han(elem);if(Locale.support.textemphasis){$elem.avoid("rt, h-char").charify({biaodian:true,punct:true})}else{$elem.avoid("rt, h-char, h-char-group").jinzify().groupify({western:true}).charify({hanzi:true,biaodian:true,punct:true,latin:true,ellinika:true,kirillica:true})}})}});Han.normalize=Locale;Han.localize=Locale;Han.support=Locale.support;Han.detectFont=Locale.detectFont;Han.fn.initCond=function(){this.condition.classList.add("han-js-rendered");Han.normalize.initCond(this.condition);return this};void["Elem","DecoLine","Em","Ruby"].forEach(function(elem){var method="render"+elem;Han.fn[method]=function(target){Han.normalize[method](this.context,target);return this}});$.extend(Han.support,{heiti:true,songti:Han.detectFont('"Han Songti"'),"songti-gb":Han.detectFont('"Han Songti GB"'),kaiti:Han.detectFont('"Han Kaiti"'),fangsong:Han.detectFont('"Han Fangsong"')});Han.correctBiaodian=function(context){var context=context||document;var finder=Han.find(context);finder.avoid("h-char").replace(/([‘“])/g,function(portion){var $char=Han.createBDChar(portion.text);$char.classList.add("bd-open","punct");return $char}).replace(/([’”])/g,function(portion){var $char=Han.createBDChar(portion.text);$char.classList.add("bd-close","bd-end","punct");return $char});return Han.support.unicoderange?finder:finder.charify({biaodian:true})};Han.correctBasicBD=Han.correctBiaodian;Han.correctBD=Han.correctBiaodian;$.extend(Han.fn,{biaodian:null,correctBiaodian:function(){this.biaodian=Han.correctBiaodian(this.context);return this},revertCorrectedBiaodian:function(){try{this.biaodian.revert("all")}catch(e){}return this}});Han.fn.correctBasicBD=Han.fn.correctBiaodian;Han.fn.revertBasicBD=Han.fn.revertCorrectedBiaodian;var hws="<<hws>>";var $hws=$.create("h-hws");$hws.setAttribute("hidden","");$hws.innerHTML=" ";function sharingSameParent($a,$b){return $a&&$b&&$a.parentNode===$b.parentNode}function properlyPlaceHWSBehind($node,text){var $elmt=$node;var text=text||"";if($.isElmt($node.nextSibling)||sharingSameParent($node,$node.nextSibling)){return text+hws}else{while(!$elmt.nextSibling){$elmt=$elmt.parentNode}if($node!==$elmt){$elmt.insertAdjacentHTML("afterEnd","<h-hws hidden> </h-hws>")}}return text}function firstStepLabel(portion,mat){return portion.isEnd&&portion.index===0?mat[1]+hws+mat[2]:portion.index===0?properlyPlaceHWSBehind(portion.node,portion.text):portion.text}function real$hwsElmt(portion){return portion.index===0?$.clone($hws):""}var last$hwsIdx;function apostrophe(portion){var $elmt=portion.node.parentNode;if(portion.index===0){last$hwsIdx=portion.endIndexInNode-2}if($elmt.nodeName.toLowerCase()==="h-hws"&&(portion.index===1||portion.indexInMatch===last$hwsIdx)){$elmt.classList.add("quote-inner")}return portion.text}function curveQuote(portion){var $elmt=portion.node.parentNode;if($elmt.nodeName.toLowerCase()==="h-hws"){$elmt.classList.add("quote-outer")}return portion.text}$.extend(Han,{renderHWS:function(context,strict){var AVOID=strict?"textarea, code, kbd, samp, pre":"textarea";var mode=strict?"strict":"base";var context=context||document;var finder=Han.find(context);finder.avoid(AVOID).replace(Han.TYPESET.hws[mode][0],firstStepLabel).replace(Han.TYPESET.hws[mode][1],firstStepLabel).replace(new RegExp("("+hws+")+","g"),real$hwsElmt).replace(/([\'"])\s(.+?)\s\1/g,apostrophe).replace(/\s[‘“]/g,curveQuote).replace(/[’”]\s/g,curveQuote).normalize();return finder}});$.extend(Han.fn,{renderHWS:function(strict){Han.renderHWS(this.context,strict);return this},revertHWS:function(){$.tag("h-hws",this.context).forEach(function(hws){$.remove(hws)});this.HWS=[];return this}});var HANGABLE_CLASS="bd-hangable";var HANGABLE_AVOID="h-char.bd-hangable";var HANGABLE_CS_HTML='<h-cs hidden class="jinze-outer hangable-outer"> </h-cs>';var matches=Han.find.matches;function detectSpaceFont(){var div=$.create("div");var ret;div.innerHTML="<span>a b</span><span style=\"font-family: 'Han Space'\">a b</span>";body.appendChild(div);ret=div.firstChild.offsetWidth!==div.lastChild.offsetWidth;$.remove(div);return ret}function insertHangableCS($jinze){var $cs=$jinze.nextSibling;if($cs&&matches($cs,"h-cs.jinze-outer")){$cs.classList.add("hangable-outer")}else{$jinze.insertAdjacentHTML("afterend",HANGABLE_CS_HTML)}}Han.support["han-space"]=detectSpaceFont();$.extend(Han,{detectSpaceFont:detectSpaceFont,isSpaceFontLoaded:detectSpaceFont(),renderHanging:function(context){var context=context||document;var finder=Han.find(context);finder.avoid("textarea, code, kbd, samp, pre").avoid(HANGABLE_AVOID).replace(TYPESET.jinze.hanging,function(portion){if(/^[\x20\t\r\n\f]+$/.test(portion.text)){return""}var $elmt=portion.node.parentNode;var $jinze,$new,$bd,biaodian;if($jinze=$.parent($elmt,"h-jinze")){insertHangableCS($jinze)}biaodian=portion.text.trim();$new=Han.createBDChar(biaodian);$new.innerHTML="<h-inner>"+biaodian+"</h-inner>";$new.classList.add(HANGABLE_CLASS);$bd=$.parent($elmt,"h-char.biaodian");return!$bd?$new:function(){$bd.classList.add(HANGABLE_CLASS);return matches($elmt,"h-inner, h-inner *")?biaodian:$new.firstChild}()});return finder}});$.extend(Han.fn,{renderHanging:function(){var classList=this.condition.classList;Han.isSpaceFontLoaded=detectSpaceFont();if(Han.isSpaceFontLoaded&&classList.contains("no-han-space")){classList.remove("no-han-space");classList.add("han-space")}Han.renderHanging(this.context);return this},revertHanging:function(){$.qsa("h-char.bd-hangable, h-cs.hangable-outer",this.context).forEach(function($elmt){var classList=$elmt.classList;classList.remove("bd-hangable");classList.remove("hangable-outer")});return this}});var JIYA_CLASS="bd-jiya";var JIYA_AVOID="h-char.bd-jiya";var CONSECUTIVE_CLASS="bd-consecutive";var JIYA_CS_HTML='<h-cs hidden class="jinze-outer jiya-outer"> </h-cs>';var matches=Han.find.matches;function trimBDClass(clazz){return clazz.replace(/(biaodian|cjk|bd-jiya|bd-consecutive|bd-hangable)/gi,"").trim()}function charifyBiaodian(portion){var biaodian=portion.text;var $elmt=portion.node.parentNode;var $bd=$.parent($elmt,"h-char.biaodian");var $new=Han.createBDChar(biaodian);var $jinze;$new.innerHTML="<h-inner>"+biaodian+"</h-inner>";$new.classList.add(JIYA_CLASS);if($jinze=$.parent($elmt,"h-jinze")){insertJiyaCS($jinze)}return!$bd?$new:function(){$bd.classList.add(JIYA_CLASS);return matches($elmt,"h-inner, h-inner *")?biaodian:$new.firstChild}()}var prevBDType,$$prevCS;function locateConsecutiveBD(portion){var prev=prevBDType;var $elmt=portion.node.parentNode;var $bd=$.parent($elmt,"h-char.biaodian");var $jinze=$.parent($bd,"h-jinze");var classList;classList=$bd.classList;if(prev){$bd.setAttribute("prev",prev)}if($$prevCS&&classList.contains("bd-open")){$$prevCS.pop().setAttribute("next","bd-open")}$$prevCS=undefined;if(portion.isEnd){prevBDType=undefined;classList.add(CONSECUTIVE_CLASS,"end-portion")}else{prevBDType=trimBDClass($bd.getAttribute("class"));classList.add(CONSECUTIVE_CLASS)}if($jinze){$$prevCS=locateCS($jinze,{prev:prev,"class":trimBDClass($bd.getAttribute("class"))})}return portion.text}function insertJiyaCS($jinze){if(matches($jinze,".tou, .touwei")&&!matches($jinze.previousSibling,"h-cs.jiya-outer")){$jinze.insertAdjacentHTML("beforebegin",JIYA_CS_HTML)}if(matches($jinze,".wei, .touwei")&&!matches($jinze.nextSibling,"h-cs.jiya-outer")){$jinze.insertAdjacentHTML("afterend",JIYA_CS_HTML)}}function locateCS($jinze,attr){var $prev,$next;if(matches($jinze,".tou, .touwei")){$prev=$jinze.previousSibling;if(matches($prev,"h-cs")){$prev.className="jinze-outer jiya-outer";$prev.setAttribute("prev",attr.prev)}}if(matches($jinze,".wei, .touwei")){$next=$jinze.nextSibling;if(matches($next,"h-cs")){$next.className="jinze-outer jiya-outer "+attr["class"];$next.removeAttribute("prev")}}return[$prev,$next]}Han.renderJiya=function(context){var context=context||document;var finder=Han.find(context);finder.avoid("textarea, code, kbd, samp, pre, h-cs").avoid(JIYA_AVOID).charify({avoid:false,biaodian:charifyBiaodian}).endAvoid().avoid("textarea, code, kbd, samp, pre, h-cs").replace(TYPESET.group.biaodian[0],locateConsecutiveBD).replace(TYPESET.group.biaodian[1],locateConsecutiveBD);return finder};$.extend(Han.fn,{renderJiya:function(){Han.renderJiya(this.context);return this},revertJiya:function(){$.qsa("h-char.bd-jiya, h-cs.jiya-outer",this.context).forEach(function($elmt){var classList=$elmt.classList;classList.remove("bd-jiya");classList.remove("jiya-outer")});return this}});var QUERY_RU_W_ANNO="h-ru[annotation]";var SELECTOR_TO_IGNORE="textarea, code, kbd, samp, pre";function createCompareFactory(font,treat,control){return function(){var a=Han.localize.writeOnCanvas(treat,font);var b=Han.localize.writeOnCanvas(control,font);return Han.localize.compareCanvases(a,b)}}function isVowelCombLigaNormal(){return createCompareFactory('"Romanization Sans"',"a̍","󰁡")}function isVowelICombLigaNormal(){return createCompareFactory('"Romanization Sans"',"i̍","󰁩")}function isZhuyinCombLigaNormal(){return createCompareFactory('"Zhuyin Kaiti"',"ㆴ͘","󳆴")}function createSubstFactory(regexToSubst){return function(context){var context=context||document;var finder=Han.find(context).avoid(SELECTOR_TO_IGNORE);regexToSubst.forEach(function(pattern){finder.replace(new RegExp(pattern[0],"ig"),function(portion,match){var ret=$.clone(charCombLiga);ret.innerHTML="<h-inner>"+match[0]+"</h-inner>";ret.setAttribute("display-as",pattern[1]);return portion.index===0?ret:""})});return finder}}var charCombLiga=$.create("h-char","comb-liga");$.extend(Han,{isVowelCombLigaNormal:isVowelCombLigaNormal(),isVowelICombLigaNormal:isVowelICombLigaNormal(),isZhuyinCombLigaNormal:isZhuyinCombLigaNormal(),isCombLigaNormal:isVowelICombLigaNormal()(),substVowelCombLiga:createSubstFactory(Han.TYPESET["display-as"]["comb-liga-vowel"]),substZhuyinCombLiga:createSubstFactory(Han.TYPESET["display-as"]["comb-liga-zhuyin"]),substCombLigaWithPUA:createSubstFactory(Han.TYPESET["display-as"]["comb-liga-pua"]),substInaccurateChar:function(context){var context=context||document;var finder=Han.find(context);finder.avoid(SELECTOR_TO_IGNORE);Han.TYPESET["inaccurate-char"].forEach(function(pattern){finder.replace(new RegExp(pattern[0],"ig"),pattern[1])})}});$.extend(Han.fn,{"comb-liga-vowel":null,"comb-liga-vowel-i":null,"comb-liga-zhuyin":null,"inaccurate-char":null,substVowelCombLiga:function(){this["comb-liga-vowel"]=Han.substVowelCombLiga(this.context);return this},substVowelICombLiga:function(){this["comb-liga-vowel-i"]=Han.substVowelICombLiga(this.context);return this},substZhuyinCombLiga:function(){this["comb-liga-zhuyin"]=Han.substZhuyinCombLiga(this.context);return this},substCombLigaWithPUA:function(){if(!Han.isVowelCombLigaNormal()){this["comb-liga-vowel"]=Han.substVowelCombLiga(this.context)}else if(!Han.isVowelICombLigaNormal()){this["comb-liga-vowel-i"]=Han.substVowelICombLiga(this.context)}if(!Han.isZhuyinCombLigaNormal()){this["comb-liga-zhuyin"]=Han.substZhuyinCombLiga(this.context)}return this},revertVowelCombLiga:function(){try{this["comb-liga-vowel"].revert("all")}catch(e){}return this},revertVowelICombLiga:function(){try{this["comb-liga-vowel-i"].revert("all")}catch(e){}return this},revertZhuyinCombLiga:function(){try{this["comb-liga-zhuyin"].revert("all")}catch(e){}return this},revertCombLigaWithPUA:function(){try{this["comb-liga-vowel"].revert("all");this["comb-liga-vowel-i"].revert("all");this["comb-liga-zhuyin"].revert("all")}catch(e){}return this},substInaccurateChar:function(){this["inaccurate-char"]=Han.substInaccurateChar(this.context);return this},revertInaccurateChar:function(){try{this["inaccurate-char"].revert("all")}catch(e){}return this}});window.addEventListener("DOMContentLoaded",function(){var initContext;if(root.classList.contains("han-init")){Han.init()}else if(initContext=document.querySelector(".han-init-context")){Han.init=Han(initContext).render()}});if(typeof noGlobalNS==="undefined"||noGlobalNS===false){window.Han=Han}return Han});
//rebuild by neat 